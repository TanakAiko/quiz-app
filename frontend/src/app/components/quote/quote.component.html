<div class="quote-container action-lines">
  <div class="container-sm">
    <!-- Loading State -->
    @if (isLoading) {
    <div class="loading-state manga-panel">
      <div class="loading-spinner">
        <div class="spinner loading-power"></div>
      </div>
      <h2>Loading Epic Quotes...</h2>
      <p class="speech-bubble">Preparing your legendary challenge! ⚡</p>
    </div>
    }

    <!-- Level Transition -->
    @if (showLevelTransition) {
    <div class="transition-state manga-panel">
      <div class="success-animation">
        <span class="success-icon">🎉</span>
      </div>
      <h2>Incredible!</h2>
      <p class="speech-bubble">Moving to the next epic quote... 🌟</p>
    </div>
    }

    <!-- Main Quiz Interface -->
    @if (!isLoading && !showLevelTransition && currentQuote) {
    <div class="quiz-interface animate-bounce-in">
      <!-- Progress Header -->
      <div class="progress-header manga-panel">
        <div class="level-info">
          <span class="level-badge">Quote {{ currentLevel + 1 }} of 5</span>
          <h1 class="quiz-title">🎌 Quote Challenge</h1>
        </div>
        
        <div class="progress-container">
          <div class="progress">
            <div 
              class="progress-bar" 
              [style.width.%]="getProgressPercentage()"
            ></div>
          </div>
          <span class="progress-text">{{ getProgressPercentage() }}% Complete</span>
        </div>
      </div>

      <!-- Quote Card -->
      <div class="quote-card card character-card animate-fade-in">
        <div class="card-body">
          <div class="quote-content">
            <div class="quote-character">
              <img src="/images/汉宫春_下扬州（晁冲之体）_文_李文冠（湖南）__一日清闲，向南门买菜，东海垂钩。_人间春山富丽，时雨飘浮。_桃蔬日渐，看白云、苍狗封侯。_天遣使、江湖不平，.jpeg" alt="Mystery Character" class="character-image mystery-character">
            </div>
            <div class="quote-icon">💭</div>
            <blockquote class="quote-text speech-bubble highlight-quote">
              "{{ currentQuote.quote }}"
            </blockquote>
            <div class="quote-attribution">
              <span class="quote-dash">—</span>
              <span class="quote-mystery">Who said this legendary quote?</span>
            </div>
            <!-- Author reveal (hidden by default, shown after correct answer) -->
            <div class="quote-author-reveal" *ngIf="results[currentLevel] === true">
              <span class="reveal-label">Answer:</span>
              <span class="reveal-author">{{ currentQuote.author || 'Correct!' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Answer Form -->
      <div class="answer-section">
        <form [formGroup]="quoteForm" (ngSubmit)="submitAuthor()" class="answer-form manga-panel">
          <div class="form-group">
            <label for="authorName" class="answer-label">
              <span class="label-icon">✍️</span>
              Enter the hero's name:
            </label>
            <input 
              type="text" 
              id="authorName" 
              placeholder="Type the legendary character's name..." 
              formControlName="author" 
              class="answer-input"
              [class.error]="errorMessage"
            >
          </div>

          <!-- Error Message -->
          @if (errorMessage) {
          <div class="alert alert-error">
            <span class="alert-icon">⚠️</span>
            {{ errorMessage }}
          </div>
          }

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button 
              type="submit" 
              [disabled]="isSubmitting || !quoteForm.get('author')?.value?.trim()" 
              class="btn btn-power btn-lg submit-btn"
            >
              @if (isSubmitting) {
                <span class="loading loading-power"></span>
                Checking...
              } @else {
                <span class="btn-icon">🎯</span>
                Submit Answer!
              }
            </button>
            
            <button 
              type="button"
              (click)="skipQuote()" 
              class="btn btn-secondary skip-btn"
            >
              <span class="btn-icon">⏭️</span>
              Skip This Quote
            </button>
          </div>
        </form>
      </div>

      <!-- Results Summary -->
      @if (getObjectKeys(results).length > 0) {
      <div class="results-summary manga-panel">
        <h3>🏆 Your Progress</h3>
        <div class="results-grid">
          @for (result of getObjectKeys(results); track result) {
          <div class="result-item" [class.correct]="results[+result]" [class.incorrect]="results[+result] === false">
            <span class="result-number">{{ +result + 1 }}</span>
            <span class="result-status">
              {{ results[+result] === true ? '✅' : results[+result] === false ? '❌' : '⏳' }}
            </span>
          </div>
          }
        </div>
      </div>
      }

      <!-- Quick Actions -->
      <div class="quick-actions">
        <button (click)="restart()" class="btn btn-secondary">
          <span class="btn-icon">🔄</span>
          Restart Quest
        </button>
        <button (click)="goHome()" class="btn btn-secondary">
          <span class="btn-icon">🏠</span>
          Return Home
        </button>
      </div>
    </div>
    }
  </div>
</div>